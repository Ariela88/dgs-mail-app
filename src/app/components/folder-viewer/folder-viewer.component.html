<div class="container">
  <div class="header-folder-viewer" [style]="{'background-color': stileComponente?.colore}">
   
    <div class="select-container"> 
      <button *ngIf="folderName === 'results'" (click)="goToInbox()" mat-raised-button>
        Torna a Tutte le mail
      </button>
      <button class="select-all-btn" (click)="toggleSelectAll()" mat-raised-button
        *ngIf="folderName !== 'all'">
        {{ allEmailsSelected() ? 'Deseleziona tutto' : 'Seleziona tutto' }} <span>({{checkedCounter(emails!)}})</span>
      </button>
      <button *ngIf="anyCheckboxSelected() && folderName !== 'trash' && folderName !== 'all'"
        (click)="deleteSelectedEmails()" class="delete-btn" mat-raised-button
        color="warn"><mat-icon>delete</mat-icon></button>
      <button *ngIf="anyCheckboxSelected() && folderName === 'trash'" (click)="deleteDefinitivlyEmail()"
        class="delete-btn" mat-raised-button color="warn"><mat-icon>delete</mat-icon></button>
    </div>


    <div class="mobile-select-container"> 
      <button *ngIf="folderName === 'results'" (click)="goToInbox()" mat-mini-fab>
        Torna a Tutte le mail
      </button>
      <button class="select-all-btn" (click)="toggleSelectAll()" mat-mini-fab
        *ngIf="folderName !== 'all'">
        {{ allEmailsSelected() ? 'ðŸž«' : 'âœ”' }} 
      </button>
      <!-- <span> Email selezionate : ({{checkedCounter(emails!)}})</span> -->
      <button *ngIf="anyCheckboxSelected() && folderName !== 'trash' && folderName !== 'all'"
        (click)="deleteSelectedEmails()" class="delete-btn" mat-mini-fab
        color="warn"><mat-icon>delete</mat-icon></button>
      <button *ngIf="anyCheckboxSelected() && folderName === 'trash'" (click)="deleteDefinitivlyEmail()"
        class="delete-btn" mat-mini-fab color="warn"><mat-icon>delete</mat-icon></button>
    </div>
    <div class="spacer"></div>
    <h2 class="folder-name"><span class="folder-name-bold"> {{folderName}} : {{emails?.length}} <span
          class="light-text-counter">({{ counter(emails!) }}) </span></span> </h2>
  </div>
  <div class="sort-container">
    <div class="spacer"> </div>
    <mat-label>Ordina per</mat-label>
    <mat-select [(value)]="sortingType" (selectionChange)="changeSortOrder()">
      <mat-option value="date">Data</mat-option>
      <mat-option value="sender">Mittente</mat-option>
    </mat-select>

  </div>
  <ul class="color-even">
    <ng-container *ngIf="!searchTerm; else searchResultsTemplate">
      <div *ngFor="let email of getSortedEmails()" class="mail-row-element">
        <span class="foldername-label" *ngIf="folderName === 'all'">{{email.folderName}}</span>
        <input type="checkbox" [(ngModel)]="email.selected" (change)="handleCheckboxChange()" class="mail-checkbox"
          *ngIf="folderName !== 'all'">
        <div class="email-details" (click)="selectedMail(email.id)">
          <span [class.bold-text]="!email.read">
            <div class="read-indicator" *ngIf="!email.sent" [ngClass]="{'unread': !email.read, 'read': email.read}">
            </div>
            <i class="material-icons" *ngIf="email.isFavorite">favorite</i>
            <i class="material-icons" *ngIf="email.important">star</i>
            <mat-icon *ngIf="email.attachment">attach_file</mat-icon>         
                   <span class="second-row" (click)="selectedMail(email.id)"><a>{{email.from}}</a></span> <br>
                   <span class="second-row" (click)="selectedMail(email.id)">Oggetto: <a>{{ email.subject }}</a></span> </span>
          <span class="time-created" *ngIf="folderName !== 'sent'">ricevuta il: {{ email.created | date:'d MMMM y' }} </span>
          <span class="time-created" *ngIf="folderName === 'sent'">inviata il: {{ email.created | date:'d MMMM y' }} <br> a:  {{email.to}}</span>
        </div>
        <span class="spacer"></span>
      </div>
    </ng-container>
    <ng-template #searchResultsTemplate>
      <div *ngFor="let email of searchResults">

        <div class="email-details">
          <i class="material-icons" *ngIf="email.isFavorite">favorite</i>
          <span>{{email.folderName? email.folderName : 'inBox'}}</span>
          <div class="read-indicator" *ngIf="folderName !== 'sent'"
            [ngClass]="{'unread': !email.read, 'read': email.read}"></div>
          <span (click)="selectedMail(email.id)" class="from-email">{{ email.sent || email.folderName==='bozze' ?
            email.to : email.from
            }}</span>
          <br>
          <span class="second-row">Oggetto: <a>{{ email.subject }}</a></span> <br>
          <span class="time-created">ricevuta il: {{ email.created | date:'d MMMM y' }}</span>
        </div>
      </div>
    </ng-template>
  </ul>

</div>