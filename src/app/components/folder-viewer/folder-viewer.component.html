<div class="container">
  <div class="header-folder-viewer">
    <button *ngIf="folderName === 'results'" (click)="goToInbox()" mat-raised-button>
      Torna a Tutte le mail
    </button>

    <div class="select-container"> <button class="select-all-btn" (click)="toggleSelectAll()" mat-raised-button
        *ngIf="folderName !== 'trash'">
        {{ allEmailsSelected() ? 'Deseleziona tutto' : 'Seleziona tutto' }} <span>({{checkedCounter(emails!)}})</span>
      </button>
      <button *ngIf="anyCheckboxSelected()" (click)="deleteSelectedEmails()"
        class="delete-btn" mat-raised-button color="warn"><mat-icon>delete</mat-icon></button>
    </div>

    <div class="spacer"></div>
    <h2 class="folder-name">Cartella <span class="folder-name-bold"> {{folderName}} : {{emails?.length}} <span
          class="light-text-counter">({{ counter(emails!) }}) </span></span> </h2>
  </div>
  <div class="sort-container">
    <mat-form-field>
      <mat-label>Ordina per</mat-label>
      <mat-select [(value)]="sortingType" (selectionChange)="changeSortOrder()">
        <mat-option value="date">Data</mat-option>
        <mat-option value="sender">Mittente</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <ul class="color-even">
    <ng-container *ngIf="!searchTerm; else searchResultsTemplate">
      <div *ngFor="let email of getSortedEmails()" class="mail-row-element">
        <span class="foldername-label" *ngIf="folderName === 'all'">{{email.folderName}}</span>

        <input type="checkbox" [(ngModel)]="email.selected" (change)="handleCheckboxChange()" class="mail-checkbox">
        <div class="email-details" (click)="selectedMail(email.id)">
          <span [class.bold-text]="!email.read">
            <div class="read-indicator" *ngIf="!email.sent" [ngClass]="{'unread': !email.read, 'read': email.read}">
            </div>

            <i class="material-icons" *ngIf="email.isFavorite">favorite</i>
            <i class="material-icons" *ngIf="email.important">star</i>
            {{email.sent ? email.to : email.from}}
          </span>
          <span class="second-row" (click)="selectedMail(email.id)">Oggetto: <a>{{ email.subject }}</a></span>
          <span class="time-created">ricevuta il: {{ email.created | date:'d MMMM y' }}</span>
        </div>
        <span class="spacer"></span>
      </div>
    </ng-container>
    <ng-template #searchResultsTemplate>
      <div *ngFor="let email of searchResults">
        <!-- <pre> {{searchResults$ | json}}</pre> -->
        <div class="email-details">
          <i class="material-icons" *ngIf="email.isFavorite">favorite</i>
          <span>{{email.folderName? email.folderName : 'inBox'}}</span>
          <div class="read-indicator" *ngIf="folderName !== 'sent'"
            [ngClass]="{'unread': !email.read, 'read': email.read}"></div>
          <span (click)="selectedMail(email.id)" class="from-email">{{ email.sent ? email.to : email.from
            }}</span>
          <br>
          <span class="second-row">Oggetto: <a>{{ email.subject }}</a></span> <br>
          <span class="time-created">ricevuta il: {{ email.created | date:'d MMMM y' }}</span>
        </div>
      </div>
    </ng-template>
  </ul>

</div>